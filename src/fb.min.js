var FB=FB||{};FB.ui=FB.ui||{};FB.ui.calendar=FB.calendar||{};FB.data=FB.data||{};FB.util=FB.util||{};
(function(){var c=FB.data.Node=function(a){this.data=a;this._max=this._parent=this._right=this._left=null;this._color=c.RED};c.BLACK=false;c.RED=true;c.LEFT=0;c.RIGHT=1;c.prototype.isRed=function(){return this._color===c.RED};c.prototype.isBlack=function(){return this._color===c.BLACK};c.prototype.setColor=function(a){return this._color=a};c.prototype.getParent=function(){return this._parent};c.prototype.setParent=function(a){this._parent=a};c.prototype.getMax=function(){return this._max};c.prototype.setMax=
function(a){this._max=a};c.prototype.getGrandfather=function(){return this.getParent()!=null?this.getParent().getParent():null};c.prototype.getChild=function(a){return a?this._right:this._left};c.prototype.setChild=function(a,b){this[b?"_right":"_left"]=a};var e=FB.data.Tree=function(a){this._root=null;this._comparator=a;this._size=0};e.prototype.getSize=function(){return this._size};e.prototype.insert=function(a){a=this._insertNode(a);for(a.setMax(this._getMax(a));a!=this._root&&a.getParent().isRed();){var b=
c.LEFT;if(a.getParent()==a.getGrandfather().getChild(c.LEFT))b=c.RIGHT;a=this._checkViolation(a,b)}this._root.setColor(c.BLACK)};e.prototype._checkViolation=function(a,b){var g=a.getGrandfather().getChild(b);g&&g.isRed()?(a.getParent().setColor(c.BLACK),g.setColor(c.BLACK),a.getGrandfather().setColor(c.RED),a=a.getGrandfather()):(a==a.getParent().getChild(b)&&(a=a.getParent(),b===c.RIGHT?this._leftRotate(a):this._rightRotate(a)),a.getParent().setColor(c.BLACK),a.getGrandfather().setColor(c.RED),b===
c.RIGHT?this._rightRotate(a.getGrandfather()):this._leftRotate(a.getGrandfather()));return a};e.prototype._getMax=function(a){var b=a.getChild(c.LEFT),g=a.getChild(c.RIGHT);return Math.max(a.data.end,Math.max(b!=null?b.getMax():0,g!=null?g.getMax():0))};e.prototype._leftRotate=function(a){this._rotate(a,c.LEFT)};e.prototype._rightRotate=function(a){this._rotate(a,c.RIGHT)};e.prototype._rotate=function(a,b){var g=b===c.RIGHT?c.LEFT:c.RIGHT,i=a.getChild(g);if(i===null)throw Error("Child is null");a.setChild(i.getChild(b),
g);i.getChild(b)!=null&&i.getChild(b).setParent(a);i.setParent(a.getParent());a.getParent()===null?this._root=i:a==a.getParent().getChild(b)?a.getParent().setChild(i,b):a.getParent().setChild(i,g);i.setChild(a,b);a.setParent(i);i.setMax(this._getMax(i));a.setMax(this._getMax(a))};e.prototype._insertNode=function(a){for(var a=new c(a),b=null,g=this._root;g!=null;)b=g,g=g.getChild(this._comparator(a.data,g.data));a.setParent(b);b===null?this._root=a:b.setChild(a,this._comparator(a.data,b.data));this._size++;
return a};e.prototype.minimum=function(a){for(a=a||this._root;a.getChild(c.LEFT)!=null;)a=a.getChild(c.LEFT);return a};e.prototype.maximum=function(a){for(a=a||this._root;a.getChild(c.RIGHT)!=null;)a=a.getChild(c.RIGHT);return a};e.prototype.successor=function(a){if(a.getChild(c.RIGHT)!=null)return this.minimum(a.getChild(c.RIGHT));for(var b=a.getParent();b&&a==b.getChild(c.RIGHT);)a=b,b=b.getParent();return b};e.prototype.predecessor=function(a){if(a.getChild(c.LEFT)!=null)return this.maximum(a.getChild(c.LEFT));
for(var b=a.getParent();b&&a==b.getChild(c.LEFT);)a=b,b=b.getParent();return b};e.prototype.getOrderedData=function(a){for(var a=this.minimum(),b=[];a!=null;)b.push(a.data),a=this.successor(a);return b};e.prototype.getOrdered=function(a){for(var a=this.minimum(),b=[];a!=null;)b.push(a),a=this.successor(a);return b};e.prototype.getReverseOrderedData=function(a){for(var a=this.maximum(),b=[];a!=null;)b.push(a.data),a=this.predecessor(a);return b};e.prototype.searchInterval=function(a,b){b=b||this._root;
result=[];var g=b.getChild(c.LEFT);g!=null&&g.getMax()>=a.start&&(result=result.concat(this.searchInterval(a,g)));h.isColliding(b.data,a)&&result.push(b.data);g=b.getChild(c.RIGHT);g!=null&&b.data.start<=a.end&&(result=result.concat(this.searchInterval(a,g)));return result};e.prototype.getBlackHeight=function(a){for(var a=a||this._root,b=0;a!=null;)a=a.getChild(0),(a===null||a.isBlack())&&b++;return b};e.prototype.debug=function(){console&&console.log&&(console.log("Size",this.getSize()),console.log("Black height",
this.getBlackHeight()),console.log("Maximum",this.maximum()),console.log("Minimum",this.minimum()),console.log("Ordered",this.getOrderedData()),console.log("Reversed Ordered",this.getReverseOrderedData()))};e.prototype.toDot=function(){var a=this.getOrdered(),b=[];b.push("digraph G {");for(var g=0,c=a.length;g<c;g++){var d=a[g],e=d.isRed()?"red":"black";b.push(d.data.id+' [label="'+d.data.id+": ["+d.data.start+","+d.data.end+"] (Max: "+d.getMax()+')",fontcolor=white,fillcolor='+e+",style=filled];");
d.getParent()&&b.push(d.getParent().data.id+" -> "+d.data.id+";")}b.push("}");return b.join("\n")};var k=FB.util.Time=function(){};k.format=function(a){var b="AM";a>=12&&(b="PM",a-=12);a==0&&(a=12);return{hours:a,suffix:b}};var j=FB.Browser=function(){};j.IE6=/msie|MSIE 6/.test(navigator.userAgent);j.IE7=/msie|MSIE 7/.test(navigator.userAgent);j.BORDER_BOX=!j.IE6&&!j.IE7;var d=FB.Element=function(){};d.getBorderWidth=function(a,b){return a.currentStyle["border"+b+"Style"]=="none"?0:parseInt(a.currentStyle["border"+
b+"Width"])||0};d.getBorderLeftWidth=function(a){return d.getBorderWidth(a,"Left")};d.getBorderRightWidth=function(a){return d.getBorderWidth(a,"Right")};d.getBorderTopWidth=function(a){return d.getBorderWidth(a,"Top")};d.getBorderBottomWidth=function(a){return d.getBorderWidth(a,"Bottom")};d.getPadding=function(a,b){return parseInt(a.currentStyle["padding"+b])||0};d.getPaddingLeft=function(a){return d.getPadding(a,"Left")};d.getPaddingRight=function(a){return d.getPadding(a,"Right")};d.getPaddingTop=
function(a){return d.getPadding(a,"Top")};d.getPaddingBottom=function(a){return d.getPadding(a,"Bottom")};d.getInset=function(){var a=document.createElement("div");a.className="event";document.body.appendChild(a);var b={borderLeft:d.getBorderLeftWidth(a),borderRight:d.getBorderRightWidth(a),borderTop:d.getBorderTopWidth(a),borderBottom:d.getBorderBottomWidth(a),paddingLeft:d.getPaddingLeft(a),paddingRight:d.getPaddingRight(a),paddingTop:d.getPaddingTop(a),paddingBottom:d.getPaddingBottom(a)};document.body.removeChild(a);
return b};var f=FB.ui.calendar.Calendar=function(a,b,c){this._events=null;this._renderedEvents={};this._tree=null;this._options=f.mergeOptions(c);b!=null&&this.setEvents(b);this._element=document.getElementById(a);this._timelineElement=document.createElement("div");this._timelineElement.className=this._options.timelineCssClass;this._element.appendChild(this._timelineElement);this._eventsElement=document.createElement("div");this._eventsElement.className=this._options.eventsCssClass;this._element.appendChild(this._eventsElement);
this._drawTimeline()};f.getDefaultOptions=function(){return{timelineCssClass:"timeline",eventsCssClass:"events",height:720,width:600,from:9,to:21}};f.mergeOptions=function(a){var b=f.getDefaultOptions();if(a!=null)for(var c in a)b[c]=a[c];return b};f.prototype.dispose=function(){this._element=this._eventsElement=this._timelineElement=null};f.prototype._drawTimeline=function(){for(var a=this._options.from,b=this._options.to,c=Math.floor(this._options.height/((b-a)*2)),d=[];a<=b;a++){var e=k.format(a);
d.push("<div style='height:"+c+"px;'><span>"+e.hours+":00 </span><span class='subTitle'>"+e.suffix+"</span></div>");a<b&&d.push("<div style='height:"+c+"px;'><span class='subTitle'>"+e.hours+":30</span></div>")}this._timelineElement.innerHTML=d.join("")};f.prototype.layOutDay=function(a){a=this.setEvents(a);this.render();return a};f.prototype.setEvents=function(a){for(var b=this._tree=new e(h.comparator),c=a.length,d=0;d<c;d++){var f=new h(a[d]);b.insert(f)}return this._events=b.getOrderedData()};
f.prototype.clear=function(){this._eventsElement.innerHTML="";this._renderedEvents={}};f.prototype.isRendered=function(a){return this._renderedEvents[a.id]===true};f.prototype._setIsRendered=function(a){this._renderedEvents[a.id]=true};f.prototype.getCollisions=function(a){return this._tree.searchInterval(a)};f.prototype.render=function(){var a=this._events;if(a===null)throw Error("No events set");this.clear();this._eventsElement.innerHTML=this._render(a).join("")};f.prototype._render=function(a,
b){for(var c=[],d=a.length,e=0;e<d;e++){var f=a[e],h=b||[];this.isRendered(f)||(this._setIsRendered(f),this._addToBin(f,h),(f=this.getCollisions(f))&&(c=c.concat(this._render(f,h))),c=c.concat(this._renderEvents(h)))}return c};f.prototype._renderEvents=function(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].events,e=0;e<d.length;e++)b.push(d[e].render(this._options.width/a.length,c));return b};f.prototype._addToBin=function(a,b){for(var c=b.length,d=false,e=0;e<c;e++){var f=b[e];if(a.start>=f.max){f.max=
a.end;f.events.push(a);d=true;break}}d||b.push({max:a.end,events:[a]})};var h=FB.ui.calendar.Event=function(a){this.id=a.id;this.start=a.start;this.end=a.end;this.height=this.width=this.left=this.top=null;this.duration=this.end-this.start};h._elementInset=null;h.getElementInset=function(){var a=h._elementInset;a==null&&(a=d.getInset("event"));return a};h.comparator=function(a,b){return a.start<b.start?0:1};h.isColliding=function(a,b){return a.start<=b.end&&a.end>=b.start?true:false};h.prototype._getElementWidth=
function(a){if(!j.BORDER_BOX){var b=h.getElementInset();a-=b.borderLeft+b.borderRight;a-=b.paddingLeft+b.paddingRight}return a};h.prototype._getElementHeight=function(a){if(!j.BORDER_BOX){var b=h.getElementInset();a-=b.borderTop+b.borderBottom;a-=b.paddingTop+b.paddingBottom}return a};h.prototype.render=function(a,b){this.width=this._getElementWidth(a);this.height=this._getElementHeight(this.duration);this.left=b*a+10;this.top=this.start;return"<div id='"+this.id+"' class='event' style='top:"+this.top+
"px; left:"+this.left+"px; width:"+this.width+"px; height:"+this.height+"px;'><div class='title'>Sample Item "+this.id+"</div><div class='subTitle'>Sample Location</div><div></div></div>"}})();